PROCEDURE LISRETEJ
*----------------
PARAMETERS XCOP
PRIVATE FILA,VRET,R1,RT,RP,E1,ET,EP,VCTC
STORE 0 TO R1,RT,E1,ET,EP,RP
DO CASE
	CASE _DEST1=1
		SET DEVICE TO FILE (P_FIL)
	CASE _DEST1=2
		SET DEVICE TO PRINTER
	CASE _DEST1=3
		SET DEVICE TO FILE (P_FIL)
ENDCASE	
SELE RET
@1,1 SAY CHR(15)
fila=8
DO imp_header  
VRET=ALLTRIM(RET.CODCTC)+ALLTRIM(RET.CODRET)
VCTC=ALLTRIM(RET.CODCTC)
IF VTOCTA=1    
FILA=FILA+1
@FILA,33  say "CUENTA CORRIENTE : "+ALLTRIM(Val_Fun('Caja','RET.CodCtc',"ALLTRIM(Codctc)+' '+Descri",RET.CodCtc))
FILA=FILA+1
@FILA,2 SAY REPLICATE("Ä",162)
FILA=FILA+1
ENDIF
SCAN
VRET=ALLTRIM(RET.CODCTC)+ALLTRIM(RET.CODRET)
	IF ALLTRIM(RET.CODCTC)<>VCTC AND VTOCTA=1
	    FILA=FILA+1
	    @FILA,2 SAY REPLICATE("Ä",162)
	    FILA=FILA+1
		@FILA,22 SAY "TOTAL RETENIDO CTACTE=>"
		@FILA,64 SAY RP PICTURE "@Z 999,999,999.99"
		@FILA,102 SAY "TOTAL EJECUTADO CTACTE=>"
		@FILA,143 SAY EP PICTURE "@Z 999,999,999.99"
	    FILA=FILA+1
	    @FILA,2 SAY REPLICATE("Ä",162)
	    FILA=FILA+1
	    STORE 0 TO RP,EP
		FILA=8
		DO IMP_HEADER
		@FILA,33  say "CUENTA CORRIENTE : "+ALLTRIM(Val_Fun('Caja','RET.CodCtc',"ALLTRIM(Codctc)+' '+Descri",RET.CodCtc))
	    FILA=FILA+1
	    @FILA,2 SAY REPLICATE("Ä",162)
	    FILA=FILA+1
    ENDIF
    @FILA,3 SAY RET.CODRET
    @FILA,12 SAY RET.NOMRET
    FILA=FILA+1
    @FILA,2 SAY REPLICATE("-",162)
    FILA=FILA+1
	SELE RETEN
	GO TOP
	LOCATE FOR ALLTRIM(RETEN.CODCTC)+ALLTRIM(RETEN.CODRET)=VRET   
	IF FOUND()
		SCAN WHILE ALLTRIM(CODCTC)+ALLTRIM(RETEN.CODRET)=VRET  &&Retenido
		    VKEY=RETEN.NUMMES+RETEN.NUMCP+RETEN.CODCTC
			@FILA,4 SAY reten.numcp
			SELE COMPAG
			SEEK VKEY
			@FILA,12 SAY SUBST(COMPAG.glosa,1,50)	
			SELE RETEN
			@FILA,64 SAY reten.valret PICTURE "@Z 999,999,999.99"
			FILA=FILA+1
			SELE COMPAG
			@FILA,12 SAY SUBST(COMPAG.glosa,51,50)	
			FILA=FILA+1
			@FILA,12 SAY SUBST(COMPAG.glosa,100,50)	
			SELE RETEN
			R1=R1+RETEN.VALRET
			RP=RP+RETEN.VALRET
			FILA=FILA+1
			IF FILA>=60
				FILA=8
				DO IMP_HEADER
			ENDIF   
		ENDSCAN
	ENDIF	
	RT=RT+R1
    FILA=FILA+1
	SELE TEMPO
	GO TOP
	LOCATE FOR ALLTRIM(TEMPO.CODCTC)+ALLTRIM(TEMPO.CODRET)=VRET
	IF FOUND()
		SCAN WHILE ALLTRIM(TEMPO.CODCTC)+ALLTRIM(TEMPO.CODRET)=VRET  &&Ejecutado
			@FILA,82 SAY TEMPO.numcp
			@FILA,92 SAY SUBST(TEMPO.glosa,1,50)	
			@FILA,143 SAY TEMPO.IMPORT PICTURE "@Z 999,999,999.99"
			FILA=FILA+1
			@FILA,92 SAY SUBST(TEMPO.glosa,51,50)	
			FILA=FILA+1
			@FILA,92 SAY SUBST(TEMPO.glosa,100,50)	
			E1=E1+TEMPO.IMPORT
			EP=EP+TEMPO.IMPORT
			FILA=FILA+1
			IF FILA>=60
				FILA=8
				DO IMP_HEADER
			ENDIF   
		ENDSCAN
	ENDIF
	SELE RET
	ET=ET+E1
    FILA=FILA+1
    @FILA,2 SAY REPLICATE("Ä",162)
    FILA=FILA+1
	@FILA,22 SAY "TOTAL RETENIDO =>"
	@FILA,64 SAY R1 PICTURE "@Z 999,999,999.99"
	@FILA,102 SAY "TOTAL EJECUTADO =>"
	@FILA,143 SAY E1 PICTURE "@Z 999,999,999.99"
    FILA=FILA+1
	STORE 0 TO E1,R1	
    @FILA,2 SAY REPLICATE("Ä",162)
    FILA=FILA+1
	IF FILA=60
		FILA=8
		DO IMP_HEADER
	ENDIF   
	IF VTOCTA=1
	    VCTC=ALLTRIM(RET.CODCTC)
    ENDIF
ENDSCAN    
IF FILA>=60
FILA=8
DO IMP_HEADER
ENDIF   
FILA=FILA+1
@FILA,2 SAY REPLICATE("Ä",162)
FILA=FILA+1
@FILA,22 SAY "TOTAL GENERAL RETENIDO =>"
@FILA,64 SAY RT PICTURE "@Z 999,999,999.99"
@FILA,102 SAY "TOTAL GENERAL EJECUTADO =>"
@FILA,143 SAY ET PICTURE "@Z 999,999,999.99"
FILA=FILA+1
@FILA,2 SAY REPLICATE("Ä",162)
SET DEVICE TO SCREEN 
RETURN
